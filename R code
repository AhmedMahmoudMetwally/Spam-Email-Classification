
install.packages("tidyverse")
install.packages("caret")
install.packages("e1071")
library(tidyverse)
library(caret)
library(e1071)

data <- read.csv("C:/Users/Pro/Downloads/email 1.csv", stringsAsFactors = TRUE)

colnames(data) <- colnames(data) %>%
  str_replace_all("Category", "label") %>%
  str_replace_all("Message", "text")

write.csv(data, "C:/Users/hapipa yasser/email_renamed.csv", row.names = FALSE)

cat(" Columns renamed successfully and saved to 'email_renamed.csv'\n")
if (!'label' %in% names(data)) {
  stop(" Error: 'label' column not found in the dataset. Please check your CSV file.")
}

data$label <- as.factor(data$label)

set.seed(123)
train_index <- createDataPartition(data$label, p = 0.7, list = FALSE)
train_data <- data[train_index, ]
test_data <- data[-train_index, ]

for (col in names(train_data)) {
  if (is.character(train_data[[col]])) {
    train_data[[col]] <- as.factor(train_data[[col]])
    test_data[[col]] <- as.factor(test_data[[col]])
  }
}

model_nb <- naiveBayes(label ~ ., data = train_data)
predictions <- predict(model_nb, test_data)
conf_mat <- confusionMatrix(predictions, test_data$label)
print(conf_mat)

saveRDS(model_nb, "spam_classifier_naive_bayes_model.rds")
cat(" Model training complete and saved as 'spam_classifier_naive_bayes_model.rds'\n")
